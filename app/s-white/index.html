<?php
  session_start();
  include "../php/connection.php";
  
  /*if user is already logged in unless the user logged out*/
  if (isset($_SESSION['ID'])) {
    header("Location: agent.html");
  }
?>
<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Twitter -->
    <meta name="twitter:site" content="@themepixels">
    <meta name="twitter:creator" content="@themepixels">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Bracket Plus">
    <meta name="twitter:description" content="Premium Quality and Responsive UI for Dashboard.">
    <meta name="twitter:image" content="http://themepixels.me/bracketplus/img/bracketplus-social.png">

    <!-- Facebook -->
    <!-- <meta property="og:url" content="http://themepixels.me/bracketplus">
    <meta property="og:title" content="Bracket Plus">
    <meta property="og:description" content="Premium Quality and Responsive UI for Dashboard.">

    <meta property="og:image" content="http://themepixels.me/bracketplus/img/bracketplus-social.png">
    <meta property="og:image:secure_url" content="http://themepixels.me/bracketplus/img/bracketplus-social.png">
    <meta property="og:image:type" content="image/png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="600"> -->

    <meta property="og:image:height" content="52">
    <meta property="og:image:width" content="99">
    <meta property="og:title" content="Maaasahan. Mapagkakatiwalaan | CitiGlobal">
    <meta property="og:description" content="Property Investment | Best Real Estate Developer in the Philippines - CitiGlobal Realty &amp;amp; Development, Inc.">
    <meta property="og:image" content="https://citiglobal.com.ph/img/facebook/meta/og-image.jpg">

    <!-- Meta -->
    <meta name="description" content="Premium Quality and Responsive UI for Dashboard.">
    <meta name="author" content="Mango System">

    <title>CitiGlobal</title>

    <!-- vendor css -->
    <link href="../lib/@fortawesome/fontawesome-free/css/all.min.css" rel="stylesheet">
    <link href="../lib/ionicons/css/ionicons.min.css" rel="stylesheet">
    <link href="../lib/rickshaw/rickshaw.min.css" rel="stylesheet">
    <link href="../lib/select2/css/select2.min.css" rel="stylesheet">

    <!-- Bracket CSS -->
    <link rel="stylesheet" href="../css/bracket.css">
    <link rel="stylesheet" href="../css/bracket.simple-white.css">
    <link rel="stylesheet" type="text/css" href="../css/global.css">
    <!-- <link rel="import" href="include/head.html"> -->

    <!-- Icons -->
    <link rel="apple-touch-icon" sizes="180x180" href="../img/icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../img/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../img/icons/favicon-16x16.png">
    <link rel="manifest" href="../img/icons/site.webmanifest">
    <link rel="shortcut icon" href="../img/icons/favicon.ico">
    <meta name="apple-mobile-web-app-title" content="CitiGlobal">
    <meta name="application-name" content="CitiGlobal">
    <meta name="msapplication-TileColor" content="#2d89ef">
    <meta name="msapplication-TileImage" content="../img/icons/mstile-144x144.png">
    <meta name="msapplication-config" content="../img/icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
  </head>

  <body>
    <!-- Modal -->
    <div id="modal" class="modal fade">
      <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content tx-size-sm">
          <div class="modal-body tx-center pd-y-20 pd-x-20">
            <button class="close" type="button" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">x</span>
            </button>
            <i class="icon ion-ios-checkmark-outline tx-100 tx-success lh-1 mg-t-20 d-inline-block"></i>
            <h4 class="tx-success mg-b-20">
              
            </h4>
          </div>
        </div>
      </div>
    </div>
    <!-- ########## START: LEFT PANEL ########## -->
    <!-- <div class="br-logo">

    </div>
    <div class="br-sideleft sideleft-scrollbar">
      
    </div> --><!-- br-sideleft -->
    <!-- ########## END: LEFT PANEL ########## -->

    <!-- ########## START: HEAD PANEL ########## -->
    <!-- <div class="br-header">
      <div class="br-header-left">
        <div class="br-logo-mobile"><a href=""><img src="../img/citiglobal-logo.png" width="200px"></a></div>
      </div>
      <div class="br-header-right">
        <div class="navicon-left hidden-md-down"><a id="btnLeftMenu" href=""><i class="icon ion-navicon-round"></i></a></div>
        <div class="navicon-left hidden-lg-up"><a id="btnLeftMenuMobile" href=""><i class="icon ion-navicon-round"></i></a></div> -->
        <!-- input-group -->
      <!-- </div> --><!-- br-header-left -->
      <!-- br-header-right -->
    <!-- </div> --><!-- br-header -->
    <!-- ########## END: HEAD PANEL ########## -->

    <!-- ########## START: RIGHT PANEL ########## -->
    <!-- br-sideright -->
    <!-- ########## END: RIGHT PANEL ########## --->

    <!-- ########## START: MAIN PANEL ########## -->
    <div class="br-mainpanel splash">
      <div class="br-pagebody splash">

        <!-- br-pagebody content -->
        <div class="wrapper d-flex align-items-center justify-content-center">  

          <div class="cont wd-xs-90p wd-md-40p ">
            <div class="row">
              <div class="col pd-b-60">
                <img class="responsive-img" src="../img/citiglobal-logo.png"> 
              </div>
            </div>
            <div class="card card-login">
              <div class="card-body pd-x-20 pd-xs-40">
                <!-- <h5 class="tx-xs-24 tx-normal tx-gray-900 mg-b-15">Sign in</h5> -->
                <form class="needs-validation" action="" method="POST" novalidate="">
                  <div class="form-group">
                    <input class="form-control" type="text" name="username" placeholder="Username" required>
                    <div class="invalid-feedback">
                      Please enter a username.
                    </div>
                  </div>
                  <div class="form-group">
                    <input class="form-control" type="password" name="password" placeholder="Password" required>
                    <div class="invalid-feedback">
                      Please enter a password.
                    </div>
                  </div>
                  <div class="form-group">
                    <input class="btn btn-info btn-block" type="submit" name="login" value="Login">
                  </div>
                </form>
              </div>
              <div class="card-footer bd-color-gray-lighter tx-center">
                <a href="../php/logout.php">Forgot Password?</a>
              </div>
            </div>
          </div>
          <ul class="bg-bubbles">
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
          </ul>
        </div>

      </div><!-- br-pagebody -->
      <footer class="br-footer justify-content-center">

      </footer>
    </div><!-- br-mainpanel -->
    <!-- ########## END: MAIN PANEL ########## -->

    <script src="../lib/jquery/jquery.min.js"></script>
    <script src="../lib/jquery-ui/ui/widgets/datepicker.js"></script>
    <script src="../lib/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="../lib/perfect-scrollbar/perfect-scrollbar.min.js"></script>
    <script src="../lib/moment/min/moment.min.js"></script>
    <script src="../lib/peity/jquery.peity.min.js"></script>
    <script src="../lib/rickshaw/vendor/d3.min.js"></script>
    <script src="../lib/rickshaw/vendor/d3.layout.min.js"></script>
    <script src="../lib/rickshaw/rickshaw.min.js"></script>
    <script src="../lib/jquery.flot/jquery.flot.js"></script>
    <script src="../lib/jquery.flot/jquery.flot.resize.js"></script>
    <script src="../lib/flot-spline/js/jquery.flot.spline.min.js"></script>
    <script src="../lib/jquery-sparkline/jquery.sparkline.min.js"></script>
    <script src="../lib/echarts/echarts.min.js"></script>
    <script src="../lib/select2/js/select2.full.min.js"></script>
    <script src="http://maps.google.com/maps/api/js?key=AIzaSyAq8o5-8Y5pudbJMJtDFzb8aHiWJufa5fg"></script>
    <script src="../lib/gmaps/gmaps.min.js"></script>

    <script src="../js/bracket.js"></script>
    <script src="../js/map.shiftworker.js"></script>
    <script src="../js/ResizeSensor.js"></script>
    <script src="../js/dashboard.js"></script>
    <script>
      // Example starter JavaScript for disabling form submissions if there are invalid fields
      (function() {
        'use strict';
        window.addEventListener('load', function() {
          // Fetch all the forms we want to apply custom Bootstrap validation styles to
          var forms = document.getElementsByClassName('needs-validation');
          // Loop over them and prevent submission
          var validation = Array.prototype.filter.call(forms, function(form) {
            form.addEventListener('submit', function(event) {
              if (form.checkValidity() === false) {
                event.preventDefault();
                event.stopPropagation();
              }
              form.classList.add('was-validated');
            }, false);
          });
        }, false);
      })();
    </script>
    <script type="text/javascript">
      //Load reusable html files
      $(document).ready(function(){
        /*$(".br-logo").load("include/logo.html");
        $(".br-sideleft").load("include/sideLeftIndex.html");*/
        $(".br-footer").load("include/footer.html");

         $("#login-button").click(function(event){
             event.preventDefault();
           
           $('.card-login').fadeOut(500);
           $('.wrapper').addClass('form-success');
        });
      });
    </script>
    <?php
      
      if (isset($_POST['username'])) {
        $uname = $conn->real_escape_string($_POST["username"]);
        //$seed = $conn->real_escape_string($_POST["password"]);
        //$passwordHash = sha1($password.$seed);
        //$pass = $conn->real_escape_string($_POST["password"]);
        $pass = sha1($conn->real_escape_string($_POST["password"]));

        //echo "$uname";
        //echo "$pass";

        $sqlSelectCount = "SELECT COUNT(*),AccountID,AccountTypeID,Username,Password,LastName,FirstName,EmployeeID,PositionID,AccountStatus FROM account WHERE Username='$uname' LIMIT 0,1";

        /*SELECT COUNT(*),AccountID,AccountTypeID,Username,Password,LastName,FirstName,EmployeeID,PositionID,AccountStatus FROM account WHERE Password='sha1("robin")' LIMIT 0,1*/

        $result = $conn->query($sqlSelectCount);
        $oneRow = $result->fetch_assoc();

        //echo $oneRow['Username'];
        //echo $oneRow['Password'];
        //echo $oneRow['FirstName'];

        $_SESSION['USER'] = $oneRow['FirstName'];

        //echo $_SESSION['USER'];
        echo '<script>$(".modal-body h4").text("Welcome '. $_SESSION['USER'] .' ");</script>';

        //proxy login
        if ($oneRow["COUNT(*)"] == 1) {
          if($oneRow['Username'] == $uname) {
            if($pass  == $oneRow['Password']) {
            /*if(sha1($pass.$seed)  == $passwordHash) {*/
              $_SESSION['LOGGEDIN'] = true;
              $_SESSION['ID'] = $oneRow['AccountID'];
              $_SESSION['USER'] = $oneRow['FirstName'];
              $_SESSION['LEVEL'] = $oneRow['AccountTypeID'];
              $_SESSION['positionID'] = $oneRow['PositionID'];

              if (isset($_SESSION['LOGGEDIN']) && $_SESSION['LOGGEDIN'] == true) {
                /*header("location: ../s-white/client.html");*/
                /*exit();*/
                if ($_SESSION['positionID'] == 1 || $_SESSION['positionID'] == 2){
                  echo '<script>window.location.replace("agent.html");</script>';  
                } elseif ($_SESSION['positionID'] == 3) {
                  echo '<script>window.location.replace("employee.html");</script>';
                }
                
                /*echo '<script>$("#modal").modal("show");</script>';*/

                //echo '<script>$("#modal-body h4").text("'. $_SESSION['USER'] .' ");</script>';
              } else {
                //
              }
            } else {
              echo '<script>$("#modal").find(".modal-body h4").text("Incorrect password, please try again.");$("#modal").modal("show");</script>';
              //echo "<pre>".print_r($_SESSION['key']='value')."</pre>";
            }
          } else {
            // this section is here in case
            // username is incorrect while oneRow
            // COUNT is equal to 1 so we can run scripts
          }
          } else {
          echo '<script>$("#modal").find(".modal-body h4").text("The username you have entered is not yet registered.");$("#modal").modal("show");</script>';
          //echo "Toggle register dropdown script";
        }
        /*if(isset($_SESSION["USER"]) ){
            header("location:main_login.html");
            exit();
            echo '<script>$(document).ready(function(){$("#modal").find(".modal-body").text("Welcome'.$_SESSION['USER'].'.");$("#modal").modal("show");});</script>';
        }*/
      }

      /*UPDATE `account` SET `Password`=sha1("robin") WHERE Username="batman"*/
    ?>
    <!-- Modal -->
    <!-- <div id="modal" class="modal fade">
      <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content tx-size-sm">
          <div class="modal-body tx-center pd-y-20 pd-x-20">
            <button class="close" type="button" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">x</span>
            </button>
            <i class="icon ion-ios-checkmark-outline tx-100 tx-success lh-1 mg-t-20 d-inline-block"></i>
            <h4 class="tx-success mg-b-20">
              <?php
                //echo $_SESSION['USER'];
              ?>
            </h4>
          </div>
        </div>
      </div>
    </div> -->
    <?php
      
    ?>
  </body>
</html>
